% vim: spl=pt
\documentclass[portuguese,minted]{artigo}
\usepackage{booktabs}
\usepackage{circuitikz}

\setmonofont{Iosevka Nerd Font Mono}

\setminted{
    frame=lines,
    framesep=2mm, 
    baselinestretch=1.2,
    fontsize=\footnotesize,
    linenos
}

\author{Louis Bergamo Radial\\8992822}
\title{MAP0214 - Cálculo Numérico Aplicado à Física\\Exercício Programa IV - Equações Diferenciais Ordinárias}
\begin{document}
\maketitle

Para os métodos numéricos, a linguagem C foi utilizada com o compilador \verb|gcc|, enquanto que os gráficos produzidos foram feitos com a biblioteca \verb|matplotlib| do Python.

\section{Método de Runge-Kutta clássico de quarta ordem}
O Exercício Programa (EP) exige a solução de EDOs de segunda ordem \(\ddot{x}(t) = g(t, x(t), \dot{x}(t))\), que podem ser manipuladas para serem tratadas como um sistema de EDOs de primeira ordem segundo
\begin{equation*}
    \dot{x}(t) = v(t) \quad\text{e}\quad \dot{v}(t) = g(t, x(t), v(t)).
\end{equation*}

Para a implementação de integração de equações diferenciais ordinárias (EDOs) foi criada uma \emph{struct} \(\verb|ode|\) que armazena tanto o ponteiro da função que caracteriza a equação diferencial quanto os parâmetros utilizados nesta função. A função \verb|compute| calcula a função da EDO no instante desejado, já utilizando os seus parâmetros.
\inputminted[firstline=5,lastline=16]{c}{src/main.c}

Para testar a implementação do método de Runge-Kutta clássico de quarta ordem (RK4) e comparar com o método de Euler, consideramos a EDO \(\ddot{y} = \dot{y} + y - t^3 - 4t^2 + 4t + 2\) com \(y(0) = \dot{y}(0) = 0,\) cuja solução analítica é \(y = t^3 + t^2.\) Para ambos os métodos, uma subrotina, \verb|euler| e \verb|rk4|, foi criada que calcula um passo da iteração e uma subrotina, \verb|solve_euler| e \verb|solve_rk4|, que itera sobre todo o período de integração e escreve os dados em um arquivo. Para uso no resto do EP, a função \verb|solve_rk4| também permite que a parte dos dados que é escrita em um arquivo seja feita a partir de um instante intermediário do período de integração.
\inputminted[firstline=18,lastline=88]{c}{src/main.c}

Para a comparação, as interações foram feitas com o passo \(h = 0.01,\) e os resultados foram plotados na \cref{fig:ex1}. Para o método de Euler, ao final da integração foi obtido
\begin{equation*}
    y_{\mathrm{Euler}}(6) = 51.206789
    \quad\text{e}\quad
    \dot{y}_{\mathrm{Euler}}(6) = -204.564558,
\end{equation*}
enquanto que para RK4, foi obtido
\begin{equation*}
    y_{\mathrm{RK4}}(6) = 251.999983
    \quad\text{e}\quad
    \dot{y}_{\mathrm{RK4}}(6) = 119.999972,
\end{equation*}
que devem ser comparados com \(y(6) = 252\) e \(\dot{y}(6) = 120.\)

\begin{figure}[!ht]
    \centering
    \includegraphics[width=0.5\textwidth]{src/1.png}
    \caption{Comparação do método RK4 e de Euler}
    \label{fig:ex1}
\end{figure}

Na \cref{fig:ex1} não é possível discernir as curvas da solução analítica e a integrada numericamente por RK4, mesmo com o passo modesto de \(h = 0.01.\) A \cref{fig:ex1b} apresenta o erro relativo entre a solução analítica e RK4, tanto para \(y\) quanto para \(\dot{y},\) mostrando que os erros foram da ordem de \(10^{-8}\) para \(y\) e \(10^{-7}\) para \(\dot{y}.\) Apesar destes gráficos mostrarem que o erro aumenta conforme o intervalo de integração aumenta, utilizaremos um passo menor para as próximas tarefas, o que reduz o erro relativo.
\begin{figure}[!ht]
    \centering
    \includegraphics[width=0.5\textwidth]{src/1b.png}
    \caption{Comparação do método RK4 e da solução analítica}
    \label{fig:ex1b}
\end{figure}

\section{Potencial poço duplo}
Consideramos o potencial de poço duplo, com equação de movimento
\begin{equation*}
    \ddot{x} = \frac12 x(1 - x^2) - 2 \gamma \dot{x} + F \cos(\omega t),
\end{equation*}
onde os parâmetros do sistema são o amortecimento \(\gamma,\) a amplitude da força externa \(F,\) e a frequência de oscilação da força externa \(\omega.\) Para este problema, definimos a função e o macro abaixo, que são usados com a subrotina \verb|solve_rk4|.
\inputminted[firstline=117,lastline=124]{c}{src/main.c}
\subsection{Espaço de fase}
Para o sistema sem amortecimento e força externa, verificamos a dependência nas condições iniciais modificando \(\dot{x}(0).\) A \cref{fig:ex2a} mostra os diagramas de espaço de fase com \(x(0) = -1,\) e \(\dot{x}(0) \in \set{0.1, 0.5, 1}.\)
\begin{figure}[!ht]
    \centering
    \includegraphics[width=0.5\textwidth]{src/2a.png}
    \caption{Espaço de fase do potencial poço duplo sem amortecimento ou força externa.}
    \label{fig:ex2a}
\end{figure}

Para o sistema com amortecimento, fixamos o \(x(0) = -1\) e \(\dot{x}(0) = -1,\) e variamos \(\gamma\). A \cref{fig:ex2b} mostra os diagramas de espaço de fase com \(2\gamma \in \set{0.25, 0.8}.\)
\begin{figure}[!ht]
    \centering
    \includegraphics[width=0.5\textwidth]{src/2b.png}
    \caption{Espaço de fase do potencial poço duplo com amortecimento.}
    \label{fig:ex2b}
\end{figure}

Para o sistema com força externa, fixamos \(2\gamma = 0.25\) e \(\omega = 0.95,\) e variamos a amplitude \(F\). A \cref{fig:ex2c} mostra os diagramas de espaço de fase com \(F \in \set{0.19, 0.203, 0.24, 0.33}\) apenas em regime estacionário. Para ignorar o transiente, utilizamos o tempo inicial de registro para \(t_i = 400\) e tempo final \(t_f\) para todos os valores de \(F\) exceto para \(F = 0.24,\) em que utilizamos \(t_i = 1200\) e \(t_f = 1500.\)
\begin{figure}[!ht]
    \centering
    \includegraphics[width=0.5\textwidth]{src/2c.png}
    \caption{Espaço de fase do potencial poço duplo com amortecimento e força externa.}
    \label{fig:ex2c}
\end{figure}

\subsection{Atratores}

Para o sistema livre, mostrado na \cref{fig:ex2a}, temos órbitas fechadas em torno dos pontos de equilíbrio estável \(x = \pm1,\) portanto os atratores são os ciclos limites. Para o sistema amortecido, conforme \cref{fig:ex2b}, o sistema não é mais conservativo e as trajetórias tendem aos pontos fixos \((x = \pm1, v = 0)\) do sistema.

O sistema forçado, apresentado na \cref{fig:ex2c}, apresenta atratores tanto de trajetórias periódicas quanto caóticas, a depender da amplitude da força externa. Para \(F\) pequeno e grande, como para \(F = 0.19\) e \(F = 0.6\) temos trajetórias periódicas, mas para valores intermediários, notavelmente \(F = 0.240,\) temos o comportamento caótico.

\subsection{Seções de Poincaré}
Para as seções de Poincaré utilizadas nos diagramas de bifurcação e no mapa de Poincaré, foi criada a subrotina \verb|poincaré|, disponível abaixo. Esta função evolui o sistema por \verb|t_periods| períodos, que deve corresponder ao transiente, e depois evolui o sistema em estado estacionário por \verb|s_periods|, escrevendo os resultados em um arquivo a cada período.
\inputminted[firstline=90,lastline=109]{c}{src/main.c}

\subsubsection{Diagrama de bifurcação}
O diagrama de bifurcação foi feito com a rotina abaixo. Nela, variamos \(F\) no intervalo \([0, 0.7]\) com um passo de \(\Delta F = 5\cdot 10^{-4},\) utilizamos um transiente de 2000 períodos e evoluímos o sistema em estado estacionário por 100 períodos.
\inputminted[firstline=155,lastline=164]{c}{src/main.c}

A \cref{fig:ex2d} mostra o diagrama de bifurcação produzido com os resultados obtidos.
\begin{figure}[!ht]
    \centering
    \begin{subfigure}{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{src/2d.png}
        \caption{Diagrama de bifurcação}
        \label{fig:ex2d}
    \end{subfigure}
    ~
    \begin{subfigure}{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{src/2d2.png}
        \caption{Região com \(0.18 \leq F \leq 0.207\)}
        \label{fig:ex2d2}
    \end{subfigure}
\end{figure}

Para estimar a constante de Feigenbaum, consideramos a região \(0.18 \leq F \leq 0.207\) e reduzimos o passo para \(\Delta F = 5 \cdot 10^{-5},\) produzindo o diagrama apresentado na \cref{fig:ex2d2}. 

\begin{table}[!ht]
    \centering
    \caption{Estimativa da constante de Feigenbaum}
    \begin{tabular}{c c c}
        \toprule
        \(n\) & \(F_n\) & \(\delta_n\)\\
        \midrule
        1 & 0.1816 & \\
        2 & 0.2007 & \\
        3 & 0.2049 & 4.54762\\
        4 & 0.2058 & 4.66667\\
        \bottomrule
    \end{tabular}
    \label{tab:feigenbaum}
\end{table}

Sendo \(F_n\) o valor de \(F\) na \(n\)-ésima bifurcação e sendo
\begin{equation*}
    \delta_n = \frac{F_{n-1} - F_{n-2}}{F_n - F_{n-1}},
\end{equation*}
obtemos uma estimativa de \(\delta \approx 4.66667\), como mostrado na \cref{tab:feigenbaum}. Para melhorar a estimativa poderíamos repetir o processo, diminuindo cada vez mais o passo e restringindo os valores de \(F\).

\subsubsection{Mapa de Poincaré}
O mapa de Poincaré foi feito com a rotina abaixo, executada a seguir da rotina do diagrama de bifurcação. Nela, executamos a função \verb|poincaré| apenas uma vez, mas com o estado estacionário sendo evoluído por 20000 períodos.
\inputminted[firstline=175,lastline=178]{c}{src/main.c}

O resultado é apresentado na \cref{fig:ex2e}.
\begin{figure}[!ht]
    \centering
    \includegraphics[width=0.5\textwidth]{src/2e.png}
    \caption{Mapa de Poincaré}
    \label{fig:ex2e}
\end{figure}

\section{Código na íntegra}
A rotina principal, cujas seções foram discutidas anteriormente, se encontra a seguir.
\inputminted[fontsize=\small]{c}{src/main.c}

O programa feito para produzir os gráficos das \cref{fig:ex1,fig:ex1b,fig:ex2a,fig:ex2b,fig:ex2c,fig:ex2d,fig:ex2d2,fig:ex2e} se encontra abaixo.
\inputminted[fontsize=\small]{python}{src/plot.py}
\end{document}
